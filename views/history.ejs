<%- include('partials/head', { title: 'Order History', showBack: true }) %>
<div class="grid gap-4">
  <h2 class="text-xl font-bold">Order History</h2>
  <form method="get" class="flex gap-2 items-end flex-wrap">
    <div>
      <label class="block text-xs font-medium">Status</label>
      <select name="status" class="border rounded px-3 py-2">
        <option value="all" <%= (filters.status==='all') ? 'selected' : '' %>>All</option>
        <option value="pending" <%= (filters.status==='pending') ? 'selected' : '' %>>Pending</option>
        <option value="completed" <%= (filters.status==='completed') ? 'selected' : '' %>>Completed</option>
      </select>
    </div>
    <div>
      <label class="block text-xs font-medium">Group</label>
      <select name="server" class="border rounded px-3 py-2">
        <option value="all" <%= (filters.server==='all') ? 'selected' : '' %>>All</option>
        <option value="1" <%= (filters.server==='1') ? 'selected' : '' %>>Boys</option>
        <option value="2" <%= (filters.server==='2') ? 'selected' : '' %>>Girls</option>
      </select>
    </div>
    <button class="btn-secondary">Apply</button>
  </form>

  <div class="bg-white rounded-xl shadow p-3">
    <div class="text-lg font-bold">Total Revenue: ₹<%= revenue %></div>
    <div class="text-sm text-slate-600 mt-1">Total Cost: ₹<%= totalCost %></div>
    <div class="text-lg font-bold mt-2 text-green-700">Total Profit: ₹<%= profit %></div>
  </div>

  <div class="space-y-3">
    <% if (orders.length === 0) { %>
      <div class="text-sm text-slate-500">No orders found.</div>
    <% } %>
    <% orders.forEach(o => { %>
      <div class="bg-white rounded-xl shadow p-3 history-card" data-status="<%= o.status %>">
        <div class="flex items-center justify-between">
          <div>
            <div class="text-sm">Token: <span class="font-bold"><%= o.token %></span></div>
            <div class="text-xs text-slate-500"><%= (o.server===2? 'Girls':'Boys') %> • <%= o.status %> • <%= fmtTime(o.completedAt || o.createdAt) %></div>
          </div>
          <div class="text-right font-semibold">₹<%= o.total %></div>
        </div>
        <div class="mt-2 text-sm">
          <% o.items.forEach(it => { %>
            <div class="flex justify-between">
              <div><%= it.name %> × <%= it.qty %></div>
              <div>₹<%= (it.price * it.qty) %></div>
            </div>
          <% }) %>
        </div>
      </div>
    <% }) %>
  </div>
</div>
<%- include('partials/foot') %>
